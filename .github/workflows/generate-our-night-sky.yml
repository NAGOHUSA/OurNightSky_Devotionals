// generate-devotional.js
// Our Night Sky — Daily devotional generator with local fallback
// Place this file in your REPO ROOT (same level as package.json and devotionals/)

const fs = require("fs");
const path = require("path");

// ---------- HELPERS ----------
function todayUTC() {
  const d = new Date();
  const yyyy = d.getUTCFullYear();
  const mm = String(d.getUTCMonth() + 1).padStart(2, "0");
  const dd = String(d.getUTCDate()).padStart(2, "0");
  return `${yyyy}-${mm}-${dd}`;
}
function ensureDir(p) {
  fs.mkdirSync(p, { recursive: true });
}

// ---------- FALLBACK DEVOTIONAL ----------
function fallbackMarkdown(dateStr) {
  return `# Our Night Sky — ${dateStr}

## Scripture
"The heavens declare the glory of God; the skies proclaim the work of his hands." — Psalm 19:1

## Reflection
Even when clouds hide the stars, God’s handiwork remains. Let tonight remind us that faith often shines brightest in the unseen.

## Prayer
Lord, steady my steps and lift my gaze. As the night sky displays Your majesty, anchor my heart in Your constant light. Amen.

## Celestial Connection
• Moon: (placeholder)
• Visible Planets: (placeholder)
• Note: Replace this with live sky data if you integrate astronomy APIs later.
`;
}

// ---------- MAIN EXECUTION ----------
(async function main() {
  try {
    const dateStr = todayUTC();
    const outDir = path.join(process.cwd(), "devotionals");
    ensureDir(outDir);

    // Placeholder for AI generation logic:
    // Try Groq, then OpenAI, then DeepSeek (coming later)
    const content = fallbackMarkdown(dateStr);

    const json = {
      app: "Our Night Sky",
      date: dateStr,
      provider: "local-fallback",
      model: "none",
      hemisphere: "Northern",
      location: null,
      content_markdown: content,
    };

    const outPath = path.join(outDir, `${dateStr}.json`);
    fs.writeFileSync(outPath, JSON.stringify(json, null, 2), "utf8");
    console.log(`✅ Generated devotional file: ${outPath}`);
  } catch (err) {
    console.error("❌ Error generating devotional:", err);
    process.exit(1);
  }
})();
